<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generate Reports</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

  <style>
    * {
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #121212;
      color: #fff;
      min-height: 100vh;
      display: flex;
    }

    /* Sidebar reserved space fix */
    .main-content {
      /* margin-left: 250px; Adjust if your sidebar width is different */
      padding: 2rem;
      width: 100%;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: #ffffff;
    }

    .report-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
    }

    .report-box {
      background-color: #1e1e1e;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      max-width: 400px;
      width: 100%;
    }

    h2 {
      margin-bottom: 1.5rem;
      color: #00d1b2;
      text-align: center;
    }

    label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.4rem;
    }

    input[type="date"],
    select {
      width: 100%;
      padding: 0.6rem;
      background-color: #2a2a2a;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
    }

    button {
      margin-top: 1.5rem;
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
      background-color: #00d1b2;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #00b49a;
    }

    @media (max-width: 768px) {
      .main-content {
        margin-left: 0;
        padding: 1rem;
      }

      .report-container {
        flex-direction: column;
        align-items: center;
      }
    }






    /* Sidebar styles */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(to right, #e8eced, #a0a8f0);
    }

    .sidebar {
      width: 270px;
      margin: 16px;
      position: fixed;
      background: #151A2D;
      border-radius: 16px;
      height: calc(100vh - 32px);
      transition: 0.4s ease;
      z-index: 1000;
    }

    .sidebar.collapsed {
      width: 85px;
    }

    .sidebar-header {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 25px 20px;
    }

    .sidebar-header .header-logo img {
      width: 50px;
      height: 50px;
      display: block;
      object-fit: contain;
      border-radius: 50%;
      background: #151A2D;

    }

    .sidebar-nav .nav-link {
      color: #fff;
      text-decoration: none;
      display: flex;
      gap: 12px;
      align-items: center;
      white-space: nowrap;
      padding: 12px 15px;
      text-decoration: none;
      transition: 0.4s ease;
      border-radius: 8px;
    }

    .sidebar-nav .nav-link:hover {
      background: #fff;
      color: #151A2D;
    }

    .sidebar-nav .nav-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 0 15px;
      transform: translateY(15px);
      transition: 0.4s ease;
    }

    .sidebar-header .toggler:hover {
      background: #dde4fb;
    }

    .sidebar-header .sidebar-toggler span {
      font-size: 1.75rem;
      transition: 0.4s ease;
    }

    .sidebar.collapsed .sidebar-header .sidebar-toggler span {
      transform: rotate(180deg);
    }

    .sidebar-header .toggler {

      height: 35px;
      width: 35px;
      border: none;
      cursor: pointer;
      color: #151A2D;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: #fff;
      transition: 0.4s ease;
    }

    .sidebar-header .sidebar-toggler {
      position: absolute;
      right: 20px;
    }

    .sidebar-header .menu-toggler {
      display: none;
    }

    .sidebar.collapsed .sidebar-header .sidebar-toggler {
      transform: translate(-4px, 65px);
    }

    .sidebar-nav .nav-link .nav-label {
      transition: opacity 0.4s ease;
    }

    .sidebar.collapsed .sidebar-nav .nav-link .nav-label {
      opacity: 0;
      pointer-events: none;
    }

    .sidebar.collapsed .sidebar-nav .primary-nav {
      transform: translateY(65px);
    }

    .sidebar-nav .nav-item {
      position: relative;
    }

    .sidebar-nav .secondary-nav {
      position: absolute;
      bottom: 30px;
      width: 100%;
    }

    .sidebar.collapsed .sidebar-nav .nav-tooltip {
      display: block;
    }

    .sidebar-nav .nav-tooltip {
      position: absolute;
      top: -10px;
      left: calc(100% + 25px);
      opacity: 0;
      display: none;
      pointer-events: none;
      color: #151A2D;
      padding: 6px 12px;
      border-radius: 8px;
      background: #fff;
      white-space: nowrap;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
      transition: 0s;
    }

    C-nav .nav-item:hover .nav-tooltip {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(50%);
      transition: 0.4s ease;
    }

    @media (max-width: 1024px) {
      .sidebar {
        height: 56px;
        overflow-y: hidden;
        margin: 13px;
        scrollbar-width: none;
        width: calc(100% - 28px);
        max-height: calc(100vh - 28px);
      }

      .sidebar.menu-active {
        overflow-y: auto;
      }

      .sidebar-header {
        position: sticky;
        top: 0;
        z-index: 20;
        background: #151A2D;
        padding: 8px 10px;
        border-radius: 10px;
      }

      .sidebar-nav .nav-list {
        padding: 0 10px;
      }

      .sidebar-header .sidebar-toggler {
        display: none;
      }

      .sidebar-header .menu-toggler {
        display: flex;
        height: 30px;
        width: 30px;
      }

      .sidebar-header .menu-toggler span {
        font-size: 1.3rem;
      }

      .sidebar-header .header-logo img {
        width: 40px;
        height: 40px;
      }

      .sidebar-nav .nav-link {
        gap: 10px;
        padding: 10px;
        font-size: 0.94rem;
      }

      .sidebar-nav .nav-link .nav-icon {
        font-size: 1.37rem;
      }

      .sidebar-nav .secondary-nav {
        position: relative;
        bottom: 0;
        margin: 40px 0 30px;
      }

    }
  </style>
</head>

<body>
  <aside class="sidebar">
    <header class="sidebar-header">
      <a href="#" class="header-logo">
        <img src="../static/pictures/Logo2.png" alt="Tadco Mart">
      </a>

      <button class="toggler sidebar-toggler" aria-label="Toggle sidebar">
        <span class="material-symbols-outlined">
          chevron_left
        </span>
      </button>
      <button class="toggler menu-toggler" aria-label="Toggle sidebar">
        <span class="material-symbols-outlined">
          menu
        </span>
      </button>
    </header>

    <!-- top primary nav -->
    <nav class="sidebar-nav">
      <ul class="nav-list primary-nav">
        <li class="nav-item">
          <a href="dashboard" class="nav-link" data-page="dashboard.html">
            <span class="nav-icon material-symbols-outlined">dashboard</span>
            <span class="nav-label">Dashboard</span>
          </a>
          <span class="nav-tooltip">Dashboard</span>
        </li>
        <li class="nav-item">
          <a href="report" class="nav-link" data-page="Report.html">
            <span class="nav-icon material-symbols-outlined">Description</span>
            <span class="nav-label">Report</span>
          </a>
          <span class="nav-tooltip">Report</span>
        </li>
        <li class="nav-item">
          <a href="suppliers" class="nav-link" data-page="Suppliers.html">
            <span class="nav-icon material-symbols-outlined">Group</span>
            <span class="nav-label">Suppliers</span>
          </a>
          <span class="nav-tooltip">Suppliers</span>
        </li>
        <li class="nav-item">
          <a href="analytics" class="nav-link" data-page="Analytics.html">
            <span class="nav-icon material-symbols-outlined">Analytics</span>
            <span class="nav-label">Analytics</span>
          </a>
          <span class="nav-tooltip">Analytics</span>
        </li>
        <li class="nav-item">
          <a href="notifi" class="nav-link" data-page="Notifi.html">
            <span class="nav-icon material-symbols-outlined">notifications</span>
            <span class="nav-label">Notifications</span>
          </a>
          <span class="nav-tooltip">Notifications</span>
        </li>
        <li class="nav-item">
          <a href="products" class="nav-link" data-page="Products.html">
            <span class="nav-icon material-symbols-outlined">Category</span>
            <span class="nav-label">Products</span>
          </a>
          <span class="nav-tooltip">Products</span>
        </li>
        <li class="nav-item">
                    <a href="order" class="nav-link" data-page="Order.html">
                        <span class="nav-icon material-symbols-outlined">star</span>
                        <span class="nav-label">Order</span>
                    </a>
                    <span class="nav-tooltip">Order</span>
                </li>
      </ul>

      <!-- secondary bottom nav -->
      <ul class="nav-list secondary-nav">
        <li class="nav-item">
          <a href="profile" class="nav-link" data-page="Profile.html">
            <span class="nav-icon material-symbols-outlined">account_circle</span>
            <span class="nav-label">Profile</span>
          </a>
          <span class="nav-tooltip">Profile</span>
        </li>
        <li class="nav-item">
          <a href="/" class="nav-link">
            <span class="nav-icon material-symbols-outlined">logout</span>
            <span class="nav-label">Logout</span>
          </a>
          <span class="nav-tooltip">Logout</span>
        </li>
      </ul>
    </nav>
  </aside>
  <div class="main-content">
    <h1>Generate Reports</h1>

    <div class="report-container">
      <!-- Stock Level Report -->
      <div class="report-box">
        <h2>Stock Level Report</h2>
        <form>
          <label for="stockStartDate">Start Date</label>
          <input type="date" id="stockStartDate" required>

          <label for="stockEndDate">End Date</label>
          <input type="date" id="stockEndDate" required>

          <button type="submit">Generate Stock Report</button>
        </form>
      </div>

      <!-- Sales Report -->
      <div class="report-box">
        <h2>Sales Report</h2>
        <form>
          <label for="salesStartDate">Start Date</label>
          <input type="date" id="salesStartDate" required>

          <label for="salesEndDate">End Date</label>
          <input type="date" id="salesEndDate" required>

          <button type="submit">Generate Sales Report</button>
        </form>
      </div>
    </div>
  </div>



  <!-- Add these scripts just before the closing </body> tag -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getDatabase, ref, get, query, orderByChild, startAt, endAt } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

  // Use the same config as in Products.html
  const firebaseConfig = {
    apiKey: "AIzaSyC-pLnAIMclS6QgEVRD3mC0Mvx6UtUSSQ0",
    authDomain: "inventory-management-sys-560b1.firebaseapp.com",
    databaseURL: "https://inventory-management-sys-560b1-default-rtdb.firebaseio.com/",
    projectId: "inventory-management-sys-560b1",
    storageBucket: "inventory-management-sys-560b1.appspot.com",
    messagingSenderId: "771187231984",
    appId: "1:771187231984:web:fab69a3ab1af7405490635",
    measurementId: "G-Q5LK8QQKCB"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // STOCK REPORT
  document.querySelector('.report-box form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const start = document.getElementById('stockStartDate').value;
    const end = document.getElementById('stockEndDate').value;
    if (!start || !end) return alert('Please select both dates.');

    // Fetch all products (stock)
    const productsSnap = await get(ref(db, "products"));
    const products = productsSnap.exists() ? productsSnap.val() : {};

    // Filter by expiry or just show all (since products don't have a created/updated date)
    // We'll show all products, but you can filter by expiry if you want
    const rows = [];
    Object.entries(products).forEach(([id, p]) => {
      // If you want to filter by expiry date:
      // if (p.expiry && p.expiry >= start && p.expiry <= end) { ... }
      rows.push([id, p.name, p.category, p.quantity, p.price, p.expiry || "N/A"]);
    });

    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Stock Level Report", 10, 10);
    doc.text(`Generated: ${new Date().toLocaleString()}`, 10, 18);
    doc.text(`From: ${start} To: ${end}`, 10, 26);

    let y = 36;
    doc.setFontSize(10);
    doc.text("ID", 10, y);
    doc.text("Name", 30, y);
    doc.text("Category", 80, y);
    doc.text("Qty", 120, y);
    doc.text("Price", 140, y);
    doc.text("Expiry", 160, y);
    y += 6;

    rows.forEach(row => {
      doc.text(String(row[0]), 10, y);
      doc.text(String(row[1]), 30, y);
      doc.text(String(row[2]), 80, y);
      doc.text(String(row[3]), 120, y);
      doc.text("₹" + Number(row[4]).toFixed(2), 140, y);
      doc.text(String(row[5]), 160, y);
      y += 6;
      if (y > 280) { doc.addPage(); y = 10; }
    });

    doc.save(`Stock_Report_${start}_to_${end}.pdf`);
  });

  // SALES REPORT
  document.querySelectorAll('.report-box form')[1].addEventListener('submit', async function(e) {
    e.preventDefault();
    const start = document.getElementById('salesStartDate').value;
    const end = document.getElementById('salesEndDate').value;
    if (!start || !end) return alert('Please select both dates.');

    // Convert date to timestamp for filtering
    const startTimestamp = new Date(start).setHours(0,0,0,0);
    const endTimestamp = new Date(end).setHours(23,59,59,999);

    // Fetch all sales
    const salesSnap = await get(ref(db, "sales"));
    const sales = salesSnap.exists() ? salesSnap.val() : {};

    // Filter sales by timestamp
    const rows = [];
    Object.values(sales).forEach(sale => {
      if (sale.timestamp >= startTimestamp && sale.timestamp <= endTimestamp) {
        rows.push([
          sale.productId,
          sale.name,
          sale.quantity,
          sale.price,
          sale.total,
          new Date(sale.timestamp).toLocaleString()
        ]);
      }
    });

    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Sales Report", 10, 10);
    doc.text(`Generated: ${new Date().toLocaleString()}`, 10, 18);
    doc.text(`From: ${start} To: ${end}`, 10, 26);

    let y = 36;
    doc.setFontSize(10);
    doc.text("Product ID", 10, y);
    doc.text("Name", 40, y);
    doc.text("Qty", 90, y);
    doc.text("Price", 110, y);
    doc.text("Total", 130, y);
    doc.text("Date", 150, y);
    y += 6;

    rows.forEach(row => {
      doc.text(String(row[0]), 10, y);
      doc.text(String(row[1]), 40, y);
      doc.text(String(row[2]), 90, y);
      doc.text("₹" + Number(row[3]).toFixed(2), 110, y);
      doc.text("₹" + Number(row[4]).toFixed(2), 130, y);
      doc.text(String(row[5]), 150, y);
      y += 6;
      if (y > 280) { doc.addPage(); y = 10; }
    });

    doc.save(`Sales_Report_${start}_to_${end}.pdf`);
  });
</script> -->




  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC-pLnAIMclS6QgEVRD3mC0Mvx6UtUSSQ0",
      authDomain: "inventory-management-sys-560b1.firebaseapp.com",
      databaseURL: "https://inventory-management-sys-560b1-default-rtdb.firebaseio.com/",
      projectId: "inventory-management-sys-560b1",
      storageBucket: "inventory-management-sys-560b1.appspot.com",
      messagingSenderId: "771187231984",
      appId: "1:771187231984:web:fab69a3ab1af7405490635",
      measurementId: "G-Q5LK8QQKCB"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // STOCK REPORT
    document.querySelectorAll('.report-box form')[0].addEventListener('submit', async function (e) {
      e.preventDefault();
      const start = document.getElementById('stockStartDate').value;
      const end = document.getElementById('stockEndDate').value;
      if (!start || !end) return alert('Please select both dates.');

      const productsSnap = await get(ref(db, "products"));
      const products = productsSnap.exists() ? productsSnap.val() : {};

      // Prepare table data
      const tableRows = Object.entries(products).map(([id, p]) => [
        id,
        p.name || "",
        p.category || "",
        p.quantity || "",
        p.price !== undefined ? "₹" + Number(p.price).toFixed(2) : "",
        p.expiry || "N/A"
      ]);

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Stock Level Report", 14, 14);
      doc.setFontSize(10);
      doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 20);
      doc.text(`From: ${start} To: ${end}`, 14, 26);

      doc.autoTable({
        startY: 32,
        head: [["Product ID", "Name", "Category", "Qty", "Price", "Expiry"]],
        body: tableRows,
        theme: 'grid',
        headStyles: { fillColor: [0, 209, 178] },
        styles: { fontSize: 10 }
      });

      doc.save(`Stock_Report_${start}_to_${end}.pdf`);
    });

    // SALES REPORT
    document.querySelectorAll('.report-box form')[1].addEventListener('submit', async function (e) {
      e.preventDefault();
      const start = document.getElementById('salesStartDate').value;
      const end = document.getElementById('salesEndDate').value;
      if (!start || !end) return alert('Please select both dates.');

      const startTimestamp = new Date(start).setHours(0, 0, 0, 0);
      const endTimestamp = new Date(end).setHours(23, 59, 59, 999);

      const salesSnap = await get(ref(db, "sales"));
      const sales = salesSnap.exists() ? salesSnap.val() : {};

      // Prepare table data
      const tableRows = Object.values(sales)
        .filter(sale => sale.timestamp >= startTimestamp && sale.timestamp <= endTimestamp)
        .map(sale => [
          sale.productId || "",
          sale.name || "",
          sale.quantity || "",
          sale.price !== undefined ? "₹" + Number(sale.price).toFixed(2) : "",
          sale.total !== undefined ? "₹" + Number(sale.total).toFixed(2) : "",
          sale.timestamp ? new Date(sale.timestamp).toLocaleString() : ""
        ]);

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Sales Report", 14, 14);
      doc.setFontSize(10);
      doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 20);
      doc.text(`From: ${start} To: ${end}`, 14, 26);

      doc.autoTable({
        startY: 32,
        head: [["Product ID", "Name", "Qty", "Price", "Total", "Date"]],
        body: tableRows,
        theme: 'grid',
        headStyles: { fillColor: [0, 209, 178] },
        styles: { fontSize: 10 }
      });

      doc.save(`Sales_Report_${start}_to_${end}.pdf`);
    });
  </script>






</body>

</html>

<script>
  const sidebar = document.querySelector(".sidebar");
  const sidebarToggler = document.querySelector(".sidebar-toggler");
  const menuToggler = document.querySelector(".menu-toggler");

  const collapsedSidebarHeight = "56px";
  const fullSidebarHeight = "calc(100vh - 32px)";

  //Toggle sidebar collapsed state
  sidebarToggler.addEventListener('click', () => {
    sidebar.classList.toggle("collapsed");
  });

  //Update sidebar height and menu toggle text
  const togglemenu = (isMenuActive) => {
    sidebar.style.height = isMenuActive ? `${sidebar.scrollHeight}px` : collapsedSidebarHeight;
    menuToggler.querySelector("span").innerText = isMenuActive ? "close" : "menu";
  };

  //Toggle menu-active class and adjust height
  menuToggler.addEventListener('click', () => {
    togglemenu(sidebar.classList.toggle("menu-active"));
  });

  window.addEventListener('resize', () => {
    if (window.innerWidth > 1024) {
      sidebar.style.height = fullSidebarHeight;
    } else {
      sidebar.classList.remove("collapsed");
      sidebar.style.height = "auto";
      togglemenu(sidebar.classList.contains("menu-active"));
    }
  });
</script>